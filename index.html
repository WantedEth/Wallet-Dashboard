<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wallet Dashboard | Multi-Chain Tracker</title>
<style>
/* --- General Reset & Body --- */
* { box-sizing: border-box; margin: 0; padding: 0; }
body { 
  font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(120deg,#1f1f2e,#2c2c3d);
  color: #f0f0f5;
  padding: 30px;
  min-height: 100vh;
}

/* --- Heading --- */
h1 {
  text-align: center;
  font-size: 2em;
  margin-bottom: 25px;
  color: #00d4ff;
  text-shadow: 0 0 10px #00d4ff44;
}

/* --- Controls --- */
.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  justify-content: center;
  margin-bottom: 20px;
}
.controls input[type=text], .controls input[type=file], button, label input[type=checkbox] {
  padding: 10px 14px;
  border-radius: 12px;
  border: none;
  background: rgba(255,255,255,0.05);
  color: #fff;
  backdrop-filter: blur(5px);
  transition: 0.3s;
  font-size: 0.95em;
}
.controls input[type=text]:focus { outline: 2px solid #00d4ff; }
button {
  background: linear-gradient(90deg,#00bfff,#00ffea);
  cursor: pointer;
  font-weight: 600;
}
button:hover {
  background: linear-gradient(90deg,#0095d1,#00ffc2);
  transform: scale(1.05);
}

/* --- Table Styling --- */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 15px;
  overflow: hidden;
  backdrop-filter: blur(10px);
  background: rgba(40,40,55,0.7);
  box-shadow: 0 5px 25px rgba(0,0,0,0.5);
  margin-bottom: 15px;
}
th, td {
  padding: 12px 15px;
  text-align: center;
  font-size: 0.9em;
  white-space: nowrap;
}
th {
  background: rgba(20,20,40,0.85);
  color: #00d4ff;
  cursor: pointer;
  position: sticky;
  top: 0;
  text-shadow: 0 0 2px #000;
}
tbody tr:hover { background: rgba(255,255,255,0.05); transition:0.3s; }

/* --- Chain Specific Colors --- */
.eth { color:#fff; }
.bsc { color:#fff; }
.poly { color:#fff; }
.base { color:#fff; }

/* --- Balance Bar Styling --- */
.balance-container {
  position: relative;
  height: 12px;
  border-radius: 6px;
  background: rgba(255,255,255,0.1);
  overflow: hidden;
  display: inline-block;
  width: 80px;
  vertical-align: middle;
  margin-left:5px;
}
.balance-fill {
  height: 100%;
  border-radius: 6px;
  transition: width 0.5s ease;
}
.eth .balance-fill { background: linear-gradient(90deg,#8e44ad,#a56ad1); }
.bsc .balance-fill { background: linear-gradient(90deg,#e67e22,#f1c40f); }
.poly .balance-fill { background: linear-gradient(90deg,#27ae60,#2ecc71); }
.base .balance-fill { background: linear-gradient(90deg,#c0392b,#ff5c5c); }

/* --- Pagination --- */
.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
}
.pagination button {
  padding: 6px 15px;
  border-radius: 10px;
  border: none;
  background: linear-gradient(90deg,#00d4ff,#00ffc2);
  color: #000;
  font-weight: 600;
  cursor: pointer;
  transition: 0.3s;
}
.pagination button:hover { background: linear-gradient(90deg,#0095d1,#00ff9c); transform: scale(1.05); }

/* --- Responsive --- */
@media(max-width:768px){ 
  table { font-size:0.8em; display:block; overflow-x:auto; }
  .controls{ flex-direction: column; align-items:center; }
}
</style>
</head>
<body>

<h1>ðŸ’Ž Wallet Dashboard | Multi-Chain Tracker</h1>

<div class="controls">
  <input type="file" id="fileInput" accept=".txt">
  <button id="loadFile">Load Wallets</button>
  <input type="text" id="search" placeholder="Search addressâ€¦">
  <label><input type="checkbox" id="filterNonZero"> Only non-zero balance</label>
  <label><input type="checkbox" id="filterTx"> Only wallets with transactions</label>
</div>

<table>
  <thead>
    <tr>
      <th>Address</th>
      <th class="eth">ETH Balance</th>
      <th class="eth">ETH Tx</th>
      <th class="bsc">BNB Balance</th>
      <th class="bsc">BNB Tx</th>
      <th class="poly">Polygon Balance</th>
      <th class="poly">Polygon Tx</th>
      <th class="base">Base Balance</th>
      <th class="base">Base Tx</th>
    </tr>
  </thead>
  <tbody id="table-body">
    <tr><td colspan="9" style="text-align:center;">No wallets loaded</td></tr>
  </tbody>
</table>

<div class="pagination">
  <button id="prev">Prev</button>
  <span id="page-info">Page 0 / 0</span>
  <button id="next">Next</button>
</div>

<script>
// --- RPC Config ---
const CHAINS = {
  Ethereum: {rpc:"https://eth1.lava.build"},
  BSC: {rpc:"https://bsc-dataseed.binance.org/"},
  Polygon: {rpc:"https://polygon-rpc.com"},
  Base: {rpc:"https://mainnet.base.org"}
};

let addresses = [];
let walletData = [];
const pageSize = 100;
let currentPage = 1;

async function rpcCall(chain, method, params){
  try{
    const res = await fetch(CHAINS[chain].rpc, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({jsonrpc:"2.0", method, params, id:1})
    });
    const data = await res.json();
    return data.result;
  }catch(e){ return null; }
}

async function getBalance(chain,address){
  const result = await rpcCall(chain,"eth_getBalance",[address,"latest"]);
  return result? parseInt(result,16)/1e18 : null;
}

async function getTxCount(chain, address){
  try{
    const normalTxHex = await rpcCall(chain, "eth_getTransactionCount", [address, "latest"]);
    const normalTx = normalTxHex ? parseInt(normalTxHex, 16) : 0;
    const latestBlockHex = await rpcCall(chain, "eth_blockNumber", []);
    const latestBlock = latestBlockHex ? parseInt(latestBlockHex, 16) : 0;
    const fromBlock = Math.max(latestBlock - 100000, 0);
    const logs = await rpcCall(chain, "eth_getLogs", [{
      fromBlock: "0x" + fromBlock.toString(16),
      toBlock: "latest",
      topics: ["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"]
    }]);
    let tokenTx = 0;
    if(logs && Array.isArray(logs)){
      tokenTx = logs.filter(l =>
        l.topics[1].toLowerCase().includes(address.toLowerCase().replace("0x","")) || 
        l.topics[2].toLowerCase().includes(address.toLowerCase().replace("0x",""))
      ).length;
    }
    return normalTx + tokenTx;
  } catch(e){
    return null;
  }
}

// --- Logarithmic bar function ---
function getBarWidth(balance){
  if(balance === null) return 0;
  // log scale for small balances
  const width = Math.log10(balance*1e6 + 1) / 6 * 100;
  return Math.min(width,100);
}

// Load wallets from file
document.getElementById('loadFile').addEventListener('click', ()=>{
  const file = document.getElementById('fileInput').files[0];
  if(!file){ alert("Please select a file"); return; }
  const reader = new FileReader();
  reader.onload = async e=>{
    addresses = e.target.result.split('\n').map(a=>a.trim()).filter(a=>a!=='');
    await loadWalletData();
  };
  reader.readAsText(file);
});

async function loadWalletData(){
  walletData = [];
  const tbody = document.getElementById("table-body");
  tbody.innerHTML = `<tr><td colspan="9" style="text-align:center;">Loading walletsâ€¦</td></tr>`;
  for(const addr of addresses){
    const [ethBal, ethTx, bnbBal, bnbTx, polyBal, polyTx, baseBal, baseTx] = await Promise.all([
      getBalance("Ethereum", addr), getTxCount("Ethereum", addr),
      getBalance("BSC", addr), getTxCount("BSC", addr),
      getBalance("Polygon", addr), getTxCount("Polygon", addr),
      getBalance("Base", addr), getTxCount("Base", addr)
    ]);
    walletData.push({addr, ethBal, ethTx, bnbBal, bnbTx, polyBal, polyTx, baseBal, baseTx});
  }
  currentPage=1;
  renderTable();
}

function renderTable(){
  const tbody = document.getElementById("table-body");
  tbody.innerHTML = "";
  const search = document.getElementById("search").value.toLowerCase();
  const filterNonZero = document.getElementById("filterNonZero").checked;
  const filterTx = document.getElementById("filterTx").checked;

  const filtered = walletData.filter(w=>{
    if(search && !w.addr.toLowerCase().includes(search)) return false;
    if(filterNonZero && (w.ethBal + w.bnbBal + w.polyBal + w.baseBal === 0)) return false;
    if(filterTx && (w.ethTx + w.bnbTx + w.polyTx + w.baseTx === 0)) return false;
    return true;
  });

  const start = (currentPage-1)*pageSize;
  const pageWallets = filtered.slice(start,start+pageSize);

  if(pageWallets.length===0){
    tbody.innerHTML = `<tr><td colspan="9" style="text-align:center;">No wallets to display</td></tr>`;
  }

  for(const w of pageWallets){
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${w.addr}</td>

      <td class="eth">
        ${w.ethBal===null?'Error':w.ethBal.toFixed(4)}
        <div class="balance-container">
          <div class="balance-fill" style="width:${getBarWidth(w.ethBal)}%"></div>
        </div>
      </td>
      <td class="eth">${w.ethTx===null?'Error':w.ethTx}</td>

      <td class="bsc">
        ${w.bnbBal===null?'Error':w.bnbBal.toFixed(4)}
        <div class="balance-container">
          <div class="balance-fill" style="width:${getBarWidth(w.bnbBal)}%"></div>
        </div>
      </td>
      <td class="bsc">${w.bnbTx===null?'Error':w.bnbTx}</td>

      <td class="poly">
        ${w.polyBal===null?'Error':w.polyBal.toFixed(4)}
        <div class="balance-container">
          <div class="balance-fill" style="width:${getBarWidth(w.polyBal)}%"></div>
        </div>
      </td>
      <td class="poly">${w.polyTx===null?'Error':w.polyTx}</td>

      <td class="base">
        ${w.baseBal===null?'Error':w.baseBal.toFixed(4)}
        <div class="balance-container">
          <div class="balance-fill" style="width:${getBarWidth(w.baseBal)}%"></div>
        </div>
      </td>
      <td class="base">${w.baseTx===null?'Error':w.baseTx}</td>
    `;
    tbody.appendChild(row);
  }

  document.getElementById("page-info").textContent = `Page ${currentPage} / ${Math.ceil(filtered.length/pageSize)}`;
}

document.getElementById("prev").onclick = ()=>{ if(currentPage>1){ currentPage--; renderTable(); } };
document.getElementById("next").onclick = ()=>{ if(currentPage*pageSize<walletData.length){ currentPage++; renderTable(); } };
document.getElementById("search").addEventListener("input",()=>{ currentPage=1; renderTable(); });
document.getElementById("filterNonZero").addEventListener("change",()=>{ currentPage=1; renderTable(); });
document.getElementById("filterTx").addEventListener("change",()=>{ currentPage=1; renderTable(); });
</script>

</body>
</html>
