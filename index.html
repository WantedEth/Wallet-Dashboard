<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wallet Dashboard | Multi-Chain Tracker</title>
<style>
body { 
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
  background:#1e1e2f; 
  color:#eee; 
  margin:0; 
  padding:20px; 
}
h1 { 
  text-align:center; 
  color:#fff; 
  margin-bottom:20px; 
  text-shadow:0 0 5px #00bfff; 
}
.controls { 
  margin-bottom:15px; 
  display:flex; 
  flex-wrap:wrap; 
  gap:10px; 
  justify-content:space-between; 
}
.controls input[type=text], .controls input[type=file], button { 
  padding:8px; 
  flex:1; 
  min-width:150px; 
  border-radius:5px; 
  border:none; 
  background:#2b2b3c; 
  color:#fff; 
}
.controls input[type=text]:focus { outline:2px solid #00bfff; }
button { background:#00bfff; transition:0.3s; }
button:hover { background:#0095d1; }

table { 
  width:100%; 
  border-collapse:collapse; 
  background:#2b2b3c; 
  overflow-x:auto; 
  display:block; 
  border-radius:8px; 
}
th, td { 
  border:1px solid #444; 
  padding:10px; 
  text-align:center; 
  font-size:0.9em; 
  white-space:nowrap; 
}
th { 
  background:#0a0a23; 
  color:#00bfff; 
  cursor:pointer; 
  position:sticky; 
  top:0; 
  text-shadow:0 0 2px #000; 
}
tbody tr:hover { background:#3a3a55; transition:0.2s; }

.eth { background:linear-gradient(90deg,#4b0082,#6a0dad); color:#fff; }
.bsc { background:linear-gradient(90deg,#ff8000,#ffbf00); color:#fff; }
.poly { background:linear-gradient(90deg,#008000,#00cc66); color:#fff; }
.base { background:linear-gradient(90deg,#8b0000,#ff4d4d); color:#fff; }

.balance-bar { display:inline-block; height:10px; border-radius:5px; margin-left:5px; vertical-align:middle; }

.pagination { margin-top:10px; text-align:center; }
.pagination button { 
  margin:0 5px; 
  padding:5px 12px; 
  cursor:pointer; 
  border-radius:5px; 
  border:none; 
  background:#00bfff; 
  color:#fff; 
  transition:0.3s; 
}
.pagination button:hover { background:#0095d1; }

@media(max-width:768px){ 
  table { font-size:0.8em; } 
  .controls{ flex-direction:column; } 
}
</style>
</head>
<body>

<h1>ðŸ’Ž Wallet Dashboard | Multi-Chain Tracker</h1>

<div class="controls">
  <input type="file" id="fileInput" accept=".txt">
  <button id="loadFile">Load Wallets</button>
  <input type="text" id="search" placeholder="Search addressâ€¦">
  <label><input type="checkbox" id="filterNonZero"> Only non-zero balance</label>
  <label><input type="checkbox" id="filterTx"> Only wallets with transactions</label>
</div>

<table>
  <thead>
    <tr>
      <th>Address</th>
      <th class="eth">ETH Balance</th>
      <th class="eth">ETH Tx</th>
      <th class="eth">ERC20 Tx</th>
      <th class="bsc">BNB Balance</th>
      <th class="bsc">BNB Tx</th>
      <th class="bsc">ERC20 Tx</th>
      <th class="poly">Polygon Balance</th>
      <th class="poly">Polygon Tx</th>
      <th class="poly">ERC20 Tx</th>
      <th class="base">Base Balance</th>
      <th class="base">Base Tx</th>
      <th class="base">ERC20 Tx</th>
    </tr>
  </thead>
  <tbody id="table-body">
    <tr><td colspan="13" style="text-align:center;">No wallets loaded</td></tr>
  </tbody>
</table>

<div class="pagination">
  <button id="prev">Prev</button>
  <span id="page-info">Page 0 / 0</span>
  <button id="next">Next</button>
</div>

<script>
const CHAINS = {
  Ethereum: {rpc:"https://eth.blockrazor.xyz"},
  BSC: {rpc:"https://bsc-dataseed.binance.org/"},
  Polygon: {rpc:"https://polygon-rpc.com"},
  Base: {rpc:"https://mainnet.base.org"}
};

let addresses = [];
let walletData = [];
const pageSize = 100;
let currentPage = 1;

async function rpcCall(chain, method, params){
  try{
    const res = await fetch(CHAINS[chain].rpc, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({jsonrpc:"2.0", method, params, id:1})
    });
    const data = await res.json();
    return data.result;
  }catch(e){ return null; }
}

async function getBalance(chain,address){
  const result = await rpcCall(chain,"eth_getBalance",[address,"latest"]);
  return result? parseInt(result,16)/1e18 : null;
}

// Separate normal vs ERC20 tx
async function getTxCounts(chain, address){
  try{
    const normalTxHex = await rpcCall(chain, "eth_getTransactionCount", [address, "latest"]);
    const normalTx = normalTxHex ? parseInt(normalTxHex,16) : 0;

    const latestBlockHex = await rpcCall(chain,"eth_blockNumber",[]);
    const latestBlock = latestBlockHex ? parseInt(latestBlockHex,16) : 0;
    const fromBlock = Math.max(latestBlock - 100000, 0);

    const logs = await rpcCall(chain,"eth_getLogs",[{
      fromBlock: "0x"+fromBlock.toString(16),
      toBlock:"latest",
      topics:["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"]
    }]);

    let tokenTx = 0;
    if(logs && Array.isArray(logs)){
      tokenTx = logs.filter(l =>
        l.topics[1].toLowerCase().includes(address.toLowerCase().replace("0x","")) ||
        l.topics[2].toLowerCase().includes(address.toLowerCase().replace("0x",""))
      ).length;
    }

    return {normalTx, tokenTx};
  }catch(e){ return {normalTx:null, tokenTx:null}; }
}

document.getElementById('loadFile').addEventListener('click', ()=>{
  const file = document.getElementById('fileInput').files[0];
  if(!file){ alert("Please select a file"); return; }
  const reader = new FileReader();
  reader.onload = async e=>{
    addresses = e.target.result.split('\n').map(a=>a.trim()).filter(a=>a!=='');
    await loadWalletData();
  };
  reader.readAsText(file);
});

async function loadWalletData(){
  walletData = [];
  const tbody = document.getElementById("table-body");
  tbody.innerHTML = `<tr><td colspan="13" style="text-align:center;">Loading walletsâ€¦</td></tr>`;

  for(const addr of addresses){
    const [ethBal, ethTxs, bnbBal, bnbTxs, polyBal, polyTxs, baseBal, baseTxs] = await Promise.all([
      getBalance("Ethereum", addr), getTxCounts("Ethereum", addr),
      getBalance("BSC", addr), getTxCounts("BSC", addr),
      getBalance("Polygon", addr), getTxCounts("Polygon", addr),
      getBalance("Base", addr), getTxCounts("Base", addr)
    ]);

    walletData.push({
      addr,
      ethBal, ethNormalTx: ethTxs.normalTx, ethTokenTx: ethTxs.tokenTx,
      bnbBal, bnbNormalTx: bnbTxs.normalTx, bnbTokenTx: bnbTxs.tokenTx,
      polyBal, polyNormalTx: polyTxs.normalTx, polyTokenTx: polyTxs.tokenTx,
      baseBal, baseNormalTx: baseTxs.normalTx, baseTokenTx: baseTxs.tokenTx
    });
  }
  currentPage=1;
  renderTable();
}

function renderTable(){
  const tbody = document.getElementById("table-body");
  tbody.innerHTML = "";
  const search = document.getElementById("search").value.toLowerCase();
  const filterNonZero = document.getElementById("filterNonZero").checked;
  const filterTx = document.getElementById("filterTx").checked;

  const filtered = walletData.filter(w=>{
    if(search && !w.addr.toLowerCase().includes(search)) return false;
    if(filterNonZero && (w.ethBal + w.bnbBal + w.polyBal + w.baseBal === 0)) return false;
    if(filterTx && (w.ethNormalTx + w.bnbNormalTx + w.polyNormalTx + w.baseNormalTx === 0)) return false;
    return true;
  });

  const start = (currentPage-1)*pageSize;
  const pageWallets = filtered.slice(start,start+pageSize);

  if(pageWallets.length===0){
    tbody.innerHTML = `<tr><td colspan="13" style="text-align:center;">No wallets to display</td></tr>`;
  }

  for(const w of pageWallets){
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${w.addr}</td>
      <td class="eth">${w.ethBal===null?'Error':w.ethBal.toFixed(4)} <span class="balance-bar" style="width:${Math.min(w.ethBal,1)*100}%; background:#8e44ad"></span></td>
      <td class="eth">${w.ethNormalTx===null?'Error':w.ethNormalTx}</td>
      <td class="eth">${w.ethTokenTx===null?'Error':w.ethTokenTx}</td>
      <td class="bsc">${w.bnbBal===null?'Error':w.bnbBal.toFixed(4)} <span class="balance-bar" style="width:${Math.min(w.bnbBal,1)*100}%; background:#e67e22"></span></td>
      <td class="bsc">${w.bnbNormalTx===null?'Error':w.bnbNormalTx}</td>
      <td class="bsc">${w.bnbTokenTx===null?'Error':w.bnbTokenTx}</td>
      <td class="poly">${w.polyBal===null?'Error':w.polyBal.toFixed(4)} <span class="balance-bar" style="width:${Math.min(w.polyBal,1)*100}%; background:#27ae60"></span></td>
      <td class="poly">${w.polyNormalTx===null?'Error':w.polyNormalTx}</td>
      <td class="poly">${w.polyTokenTx===null?'Error':w.polyTokenTx}</td>
      <td class="base">${w.baseBal===null?'Error':w.baseBal.toFixed(4)} <span class="balance-bar" style="width:${Math.min(w.baseBal,1)*100}%; background:#c0392b"></span></td>
      <td class="base">${w.baseNormalTx===null?'Error':w.baseNormalTx}</td>
      <td class="base">${w.baseTokenTx===null?'Error':w.baseTokenTx}</td>
    `;
    tbody.appendChild(row);
  }

  document.getElementById("page-info").textContent = `Page ${currentPage} / ${Math.ceil(filtered.length/pageSize)}`;
}

document.getElementById("prev").onclick = ()=>{ if(currentPage>1){ currentPage--; renderTable(); } };
document.getElementById("next").onclick = ()=>{ if(currentPage*pageSize<walletData.length){ currentPage++; renderTable(); } };

document.getElementById("search").addEventListener("input",()=>{ currentPage=1; renderTable(); });
document.getElementById("filterNonZero").addEventListener("change",()=>{ currentPage=1; renderTable(); });
document.getElementById("filterTx").addEventListener("change",()=>{ currentPage=1; renderTable(); });
</script>

</body>
</html>
