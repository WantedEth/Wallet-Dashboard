<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wallet Dashboard | Multi-Chain Tracker</title>
<style>
body { font-family: Arial, sans-serif; background:#f5f7fa; margin:0; padding:20px; }
h1 { text-align:center; color:#2b2b2b; margin-bottom:20px; }
.controls { margin-bottom:15px; display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; }
.controls input[type=text], .controls input[type=file] { padding:5px; flex:1; min-width:150px; }
.controls label { display:flex; align-items:center; gap:5px; font-size:0.9em; }
button { padding:5px 10px; cursor:pointer; }
table { width:100%; border-collapse:collapse; background:white; overflow-x:auto; display:block; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; font-size:0.9em; white-space:nowrap; }
th { background:#007bff; color:white; cursor:pointer; position:sticky; top:0; }
tbody tr:hover { background:#f0f4ff; }
.pagination { margin-top:10px; text-align:center; }
.pagination button { margin:0 5px; padding:5px 10px; cursor:pointer; }
@media(max-width:768px){ table { font-size:0.8em; } .controls{ flex-direction:column; } }
</style>
</head>
<body>

<h1>ðŸ’Ž Wallet Dashboard | Multi-Chain Tracker</h1>

<div class="controls">
  <input type="file" id="fileInput" accept=".txt">
  <button id="loadFile">Load Wallets</button>
  <input type="text" id="search" placeholder="Search addressâ€¦">
  <label><input type="checkbox" id="filterNonZero"> Only non-zero balance</label>
  <label><input type="checkbox" id="filterTx"> Only wallets with transactions</label>
</div>

<table>
  <thead>
    <tr>
      <th data-col="0">Address</th>
      <th data-col="1">ETH Balance</th>
      <th data-col="2">ETH Tx</th>
      <th data-col="3">BNB Balance</th>
      <th data-col="4">BNB Tx</th>
      <th data-col="5">Polygon Balance</th>
      <th data-col="6">Polygon Tx</th>
      <th data-col="7">Base Balance</th>
      <th data-col="8">Base Tx</th>
    </tr>
  </thead>
  <tbody id="table-body">
    <tr><td colspan="9" style="text-align:center;">No wallets loaded</td></tr>
  </tbody>
</table>

<div class="pagination">
  <button id="prev">Prev</button>
  <span id="page-info">Page 0 / 0</span>
  <button id="next">Next</button>
</div>

<script>
const CHAINS = {
  Ethereum: {balance:"https://api.etherscan.io/api?module=account&action=balance&address={address}&tag=latest", tx:"https://api.etherscan.io/api?module=account&action=txlist&address={address}&page=1&offset=1&sort=desc"},
  BSC: {balance:"https://api.bscscan.com/api?module=account&action=balance&address={address}", tx:"https://api.bscscan.com/api?module=account&action=txlist&address={address}&page=1&offset=1&sort=desc"},
  Polygon: {balance:"https://api.polygonscan.com/api?module=account&action=balance&address={address}", tx:"https://api.polygonscan.com/api?module=account&action=txlist&address={address}&page=1&offset=1&sort=desc"},
  Base: {balance:"https://base.blockscout.com/api?module=account&action=balance&address={address}", tx:"https://base.blockscout.com/api?module=account&action=txlist&address={address}&page=1&offset=1&sort=desc"}
};

let addresses = [];
let walletData = [];
const pageSize = 25;
let currentPage = 1;

// Fetch helpers
async function fetchJSON(url){ try{ const res=await fetch(url); return await res.json(); }catch(e){ return null; } }
async function getBalance(chain,address){
  const url = CHAINS[chain].balance.replace("{address}", address);
  const data = await fetchJSON(url);
  if(data && data.result) return typeof data.result==="string"? (data.result.startsWith("0x")? parseInt(data.result,16)/1e18 : parseFloat(data.result)/1e18) : parseFloat(data.result)/1e18;
  return null;
}
async function getTxCount(chain,address){
  const url = CHAINS[chain].tx.replace("{address}", address);
  const data = await fetchJSON(url);
  if(data && data.result) return Array.isArray(data.result)? data.result.length : 0;
  return null;
}

// Load wallets from uploaded file
document.getElementById('loadFile').addEventListener('click', ()=>{
  const file = document.getElementById('fileInput').files[0];
  if(!file){ alert("Please select a file"); return; }
  const reader = new FileReader();
  reader.onload = async e=>{
    addresses = e.target.result.split('\n').map(a=>a.trim()).filter(a=>a!=='');
    await loadWalletData();
  };
  reader.readAsText(file);
});

// Load balances and transactions
async function loadWalletData(){
  walletData = [];
  const tbody = document.getElementById("table-body");
  tbody.innerHTML = `<tr><td colspan="9" style="text-align:center;">Loading walletsâ€¦</td></tr>`;

  for(const addr of addresses){
    const [ethBal, ethTx, bnbBal, bnbTx, polyBal, polyTx, baseBal, baseTx] = await Promise.all([
      getBalance("Ethereum", addr), getTxCount("Ethereum", addr),
      getBalance("BSC", addr), getTxCount("BSC", addr),
      getBalance("Polygon", addr), getTxCount("Polygon", addr),
      getBalance("Base", addr), getTxCount("Base", addr)
    ]);
    walletData.push({addr, ethBal, ethTx, bnbBal, bnbTx, polyBal, polyTx, baseBal, baseTx});
  }
  currentPage = 1;
  renderTable();
}

// Render table with pagination and filters
function renderTable(){
  const tbody = document.getElementById("table-body");
  tbody.innerHTML = "";
  const search = document.getElementById("search").value.toLowerCase();
  const filterNonZero = document.getElementById("filterNonZero").checked;
  const filterTx = document.getElementById("filterTx").checked;

  const filtered = walletData.filter(w=>{
    if(search && !w.addr.toLowerCase().includes(search)) return false;
    if(filterNonZero && (w.ethBal + w.bnbBal + w.polyBal + w.baseBal === 0)) return false;
    if(filterTx && (w.ethTx + w.bnbTx + w.polyTx + w.baseTx === 0)) return false;
    return true;
  });

  const start = (currentPage-1)*pageSize;
  const pageWallets = filtered.slice(start, start+pageSize);

  if(pageWallets.length===0){
    tbody.innerHTML = `<tr><td colspan="9" style="text-align:center;">No wallets to display</td></tr>`;
  }

  for(const w of pageWallets){
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${w.addr}</td>
      <td>${w.ethBal===null?'Error':w.ethBal.toFixed(4)}</td>
      <td>${w.ethTx===null?'Error':w.ethTx}</td>
      <td>${w.bnbBal===null?'Error':w.bnbBal.toFixed(4)}</td>
      <td>${w.bnbTx===null?'Error':w.bnbTx}</td>
      <td>${w.polyBal===null?'Error':w.polyBal.toFixed(4)}</td>
      <td>${w.polyTx===null?'Error':w.polyTx}</td>
      <td>${w.baseBal===null?'Error':w.baseBal.toFixed(4)}</td>
      <td>${w.baseTx===null?'Error':w.baseTx}</td>
    `;
    tbody.appendChild(row);
  }

  document.getElementById("page-info").textContent = `Page ${currentPage} / ${Math.ceil(filtered.length/pageSize)}`;
}

// Pagination buttons
document.getElementById("prev").onclick = ()=>{ if(currentPage>1){ currentPage--; renderTable(); } };
document.getElementById("next").onclick = ()=>{ currentPage++; renderTable(); };

// Filters and search
document.getElementById("search").addEventListener("input",()=>{ currentPage=1; renderTable(); });
document.getElementById("filterNonZero").addEventListener("change",()=>{ currentPage=1; renderTable(); });
document.getElementById("filterTx").addEventListener("change",()=>{ currentPage=1; renderTable(); });
</script>
</body>
</html>
